# AWS Credentials Fix Commands for EC2

# 1. SSH into the server
ssh -i amond.pem ec2-user@ec2-52-78-91-203.ap-northeast-2.compute.amazonaws.com

# 2. Navigate to backend directory
cd /home/ec2-user/amond/backend

# 3. Check current PM2 environment variables
pm2 env backend | grep -E "AWS|NODE_ENV"

# 4. Check if .env file exists and has AWS credentials
ls -la .env
grep "AWS_" .env

# 5. If .env file is missing or incomplete, wait for deployment to complete
# Check deployment logs
tail -f /home/ec2-user/.pm2/logs/backend-out.log

# 6. Once deployment is complete, restart PM2 with environment update
pm2 restart backend --update-env

# 7. Verify environment variables are loaded
pm2 env backend | grep AWS

# 8. Check application logs for AWS credential status
pm2 logs backend --lines 50 | grep "AWS Environment Check"

# 9. If still not working, try full restart
pm2 stop backend
pm2 delete backend
pm2 start app.ts --name backend
pm2 save

# 10. Test the application
curl http://localhost:8080/health

# Alternative: Manual environment variable injection
# If GitHub secrets aren't working, you can manually add them
echo "AWS_ACCESS_KEY=your_access_key_here" >> .env
echo "AWS_SECRET_ACCESS=your_secret_key_here" >> .env
pm2 restart backend --update-env