<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>INICIS Demo Style Payment</title>
    <script type="text/javascript" src="https://stgstdpay.inicis.com/stdjs/INIStdPay.js" charset="UTF-8"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        .demo-box {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        button {
            background-color: #5f0080;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
        }
        button:hover {
            background-color: #7a0099;
        }
        .info {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>INICIS ë°ëª¨ ìŠ¤íƒ€ì¼ ê²°ì œ</h1>
    
    <div class="info">
        <h3>ğŸ“Œ í…ŒìŠ¤íŠ¸ ì •ë³´</h3>
        <p>ì´ í˜ì´ì§€ëŠ” INICIS ë°ëª¨ì™€ ë™ì¼í•œ íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
        <p>ì •ê¸°ê²°ì œë¥¼ ìœ„í•œ ë¹Œë§í‚¤ ë°œê¸‰ê³¼ ì¼ë°˜ê²°ì œë¥¼ í•¨ê»˜ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
    </div>

    <div class="demo-box">
        <h2>1. ì¼ë°˜ ê²°ì œ (ë°ëª¨ì™€ ë™ì¼)</h2>
        <p>HPP(1):below1000:va_receipt:centerCd(Y) ì‚¬ìš©</p>
        <button onclick="testRegularPayment()">ì¼ë°˜ ê²°ì œ í…ŒìŠ¤íŠ¸</button>
    </div>

    <div class="demo-box">
        <h2>2. ì •ê¸°ê²°ì œìš© ë¹Œë§í‚¤ ë°œê¸‰</h2>
        <p>BILLAUTH ì—†ì´ ì¼ë°˜ê²°ì œ í›„ ë¹Œë§í‚¤ ì¶”ì¶œ ì‹œë„</p>
        <button onclick="testBillingWithRegular()">ì •ê¸°ê²°ì œ ë“±ë¡ (ì¼ë°˜ê²°ì œ ë°©ì‹)</button>
    </div>

    <div class="demo-box">
        <h2>3. í˜¼í•© ë°©ì‹</h2>
        <p>ì¼ë°˜ê²°ì œ + BILLAUTH í˜¼í•©</p>
        <button onclick="testMixedBilling()">í˜¼í•© ë°©ì‹ í…ŒìŠ¤íŠ¸</button>
    </div>

    <div id="result" class="result" style="display:none;"></div>

    <!-- Form for payment -->
    <form id="paymentForm" method="POST" style="display:none;">
        <input type="hidden" name="version" value="1.0">
        <input type="hidden" name="gopaymethod" value="">
        <input type="hidden" name="mid" value="INIBillTst">
        <input type="hidden" name="oid" value="">
        <input type="hidden" name="price" value="1000">
        <input type="hidden" name="timestamp" value="">
        <input type="hidden" name="signature" value="">
        <input type="hidden" name="mKey" value="">
        <input type="hidden" name="currency" value="WON">
        <input type="hidden" name="goodname" value="í…ŒìŠ¤íŠ¸ìƒí’ˆ">
        <input type="hidden" name="buyername" value="í…ŒìŠ¤í„°">
        <input type="hidden" name="buyertel" value="01012345678">
        <input type="hidden" name="buyeremail" value="test@test.com">
        <input type="hidden" name="returnUrl" value="http://localhost:3000/billing-return">
        <input type="hidden" name="closeUrl" value="http://localhost:3000/close.html">
        <input type="hidden" name="acceptmethod" value="">
        <input type="hidden" name="charset" value="UTF-8">
        <input type="hidden" name="languageView" value="ko">
        <input type="hidden" name="payViewType" value="overlay">
        <input type="hidden" name="offerPeriod" value="">
    </form>

    <script>
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        async function setupPayment(gopaymethod, acceptmethod, offerPeriod = '') {
            const timestamp = Date.now().toString();
            const oid = "DemoTest_" + timestamp;
            
            // Set form values
            document.getElementsByName("gopaymethod")[0].value = gopaymethod;
            document.getElementsByName("oid")[0].value = oid;
            document.getElementsByName("timestamp")[0].value = timestamp;
            document.getElementsByName("acceptmethod")[0].value = acceptmethod;
            document.getElementsByName("offerPeriod")[0].value = offerPeriod;
            
            // Generate keys
            const signKey = "SU5JTElURV9UUklQTEVERVNfS0VZU1RS";
            const mKey = await sha256(signKey);
            document.getElementsByName("mKey")[0].value = mKey;
            
            // Generate signature
            const signatureData = `oid=${oid}&price=1000&timestamp=${timestamp}`;
            const signature = await sha256(signatureData);
            document.getElementsByName("signature")[0].value = signature;
            
            showResult(`ê²°ì œ ìš”ì²­ ì¤‘...\nOID: ${oid}\nMethod: ${acceptmethod}`);
            
            try {
                INIStdPay.pay('paymentForm');
            } catch (e) {
                showResult(`ì˜¤ë¥˜: ${e.message}`, true);
            }
        }

        function testRegularPayment() {
            // ë°ëª¨ì™€ ì™„ì „íˆ ë™ì¼í•œ íŒŒë¼ë¯¸í„°
            setupPayment('', 'HPP(1):below1000:va_receipt:centerCd(Y)', '');
        }

        function testBillingWithRegular() {
            // ì¼ë°˜ê²°ì œ ë°©ì‹ìœ¼ë¡œ ì •ê¸°ê²°ì œ ì‹œë„ (M2 ì¶”ê°€)
            setupPayment('', 'HPP(1):below1000:va_receipt:centerCd(Y)', 'M2');
        }

        function testMixedBilling() {
            // BILLAUTHë¥¼ acceptmethod ë’¤ì— ì¶”ê°€
            setupPayment('Card', 'HPP(1):below1000:va_receipt:centerCd(Y):BILLAUTH(Card)', 'M2');
        }

        function showResult(message, isError = false) {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<pre style="color: ${isError ? 'red' : 'black'}">${message}</pre>`;
        }

        // Listen for payment result
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'payment_result') {
                showResult('ê²°ì œ ê²°ê³¼:\n' + JSON.stringify(event.data.params, null, 2));
            }
        });
    </script>
</body>
</html>